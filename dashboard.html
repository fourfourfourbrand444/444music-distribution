<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>My Releases</title>
<link rel="stylesheet" href="dashboard.css">
</head>
<body>
<div class="header">
  <h1>My Releases</h1>
</div>
<div class="container" id="submissionsContainer">
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
import { getFirestore, collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBzUD7avh7vJfeSMRl2o9F09_qd-pl0dSg",
  authDomain: "usersubmissionsportal.firebaseapp.com",
  projectId: "usersubmissionsportal",
  storageBucket: "usersubmissionsportal.firebasestorage.app",
  messagingSenderId: "734783502459",
  appId: "1:734783502459:web:cfa2cc5de6976003b24ade"
};;

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const container = document.getElementById("submissionsContainer");

let currentUser = null;
onAuthStateChanged(auth, async (user)=>{
  if(!user) { window.location.href="login.html"; return; }
  currentUser=user;

  try{
    const q=query(collection(db,"submissions"), where("userId","==",currentUser.uid));
    const snapshot=await getDocs(q);

    if(snapshot.empty){
      container.innerHTML='<div class="empty">No submissions yet</div>';
      return;
    }

    snapshot.forEach(docSnap=>{
      const data=docSnap.data();
      const card=document.createElement("div");
      card.className="card";
      card.innerHTML=`
        <img src="${data.coverURL || 'default_cover.png'}" alt="Cover Art">
        <div class="card-body">
          <h3>${data.releaseTitle}</h3>
          <p>${data.artistName}</p>
          <span class="badge ${data.status.toLowerCase()}">${data.status}</span>
        </div>
      `;
      container.appendChild(card);
    });
  }catch(err){
    console.error("Error fetching submissions:", err);
    container.innerHTML='<div class="empty">Failed to load submissions</div>';
  }
});
</script>
</body>
</html>
